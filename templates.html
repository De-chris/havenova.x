<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HX Store | Premium Assets</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <link rel="stylesheet" href="style.css">
  <style>
    /* Fixed Header - Removed Blue, Matched Body */
    header {
      background: rgba(15, 23, 42, 0.95) !important; /* Dark match */
      border-bottom: 1px solid #334155;
    }

    /* Store Grid */
    .store-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .template-card {
      cursor: pointer;
      position: relative;
      transition: transform 0.3s;
    }
    .template-card:hover { transform: translateY(-5px); }

    .template-img-thumb {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 12px;
    }

    /* Full-Screen Detail Overlay */
    .detail-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: #0f172a;
      z-index: 10000;
      overflow-y: auto;
      padding: 20px;
    }

    .detail-content {
      max-width: 800px;
      margin: 40px auto;
      text-align: center;
    }

    .full-img-container {
      width: 100%;
      overflow: hidden;
      border-radius: 12px;
      margin-bottom: 20px;
      background: #1e293b;
    }

    .full-img {
      width: 100%;
      cursor: zoom-in;
      transition: transform 0.3s;
    }

    .full-img:active { transform: scale(2); cursor: zoom-out; }

    .status-pill {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: bold;
      text-transform: uppercase;
      font-size: 12px;
      margin-bottom: 10px;
    }
    .pill-free { background: #00d2ff; color: #000; }
    .pill-paid { background: #ffca28; color: #000; }

    /* Custom Back Button */
    .back-store {
      position: absolute;
      top: 20px; left: 20px;
      color: white; font-size: 20px; cursor: pointer;
    }

    .modal { z-index: 11000; }
  </style>
</head>
<body class="dark">

  <div id="buyModal" class="modal">
    <div class="modal-content" style="margin: 15% auto; padding: 30px; border-radius: 15px; max-width: 400px; text-align: center; background: #1e293b; color: #eee;">
      <i class="fas fa-shield-alt" style="font-size: 3rem; color: #00d2ff;"></i>
      <h3>Admin Verification</h3>
      <p>Redirecting to <b>@dechrisathx</b> for secure manual payment and file delivery.</p>
      <button id="confirmBuy" class="btn" style="width:100%">Proceed to Telegram</button>
      <p onclick="closeModal()" style="margin-top:15px; cursor:pointer; font-size:12px; opacity:0.6;">Cancel</p>
    </div>
  </div>

  <div id="detailOverlay" class="detail-overlay">
    <i class="fas fa-arrow-left back-store" onclick="closeDetail()"></i>
    <div class="detail-content">
      <div id="detailStatus" class="status-pill"></div>
      <h2 id="detailTitle">Template Name</h2>
      <div class="full-img-container">
        <img id="detailImg" src="" class="full-img" title="Click to Zoom">
      </div>
      <p id="detailDesc" style="margin-bottom: 20px; opacity: 0.9;"></p>
      <div id="detailActionArea"></div>
      
      <div style="margin-top: 40px; border-top: 1px solid #334155; padding-top: 20px;">
         <h4>Community Discussion</h4>
         <div id="cusdis_thread"></div>
      </div>
    </div>
  </div>

  <header>
    <a href="index.html"><img src="logo1.png" alt="HX" class="logo" /></a>
    <button onclick="document.body.classList.toggle('dark')"><i class="fas fa-adjust"></i></button>
  </header>

  <main id="mainContent">
    <section style="text-align: center; margin-bottom: 20px;">
      <h1>Marketplace</h1>
      <p>Professional codes & "Godly" tech assets.</p>
    </section>

    <div id="loading"><i class="fas fa-spinner fa-spin"></i> Syncing Database...</div>
    <div id="template-container" class="store-grid"></div>
  </main>

  <script>
    const api_url = "https://script.google.com/macros/s/AKfycbzpxWVXd9pUQe5cJCTJyxtNB6TVto1TEDPmwRYq3bo0eKjfKfPWm558HeMh3EaOCMfl/exec";
    let allTemplates = [];
    let currentRedirectUrl = "";

    async function fetchTemplates() {
      try {
        const response = await fetch(api_url);
        const data = await response.json();
        allTemplates = data;
        renderTemplates(data);
        document.getElementById('loading').style.display = 'none';
      } catch (e) { console.error(e); }
    }

    function renderTemplates(items) {
      const container = document.getElementById('template-container');
      container.innerHTML = '';

      items.forEach((item) => {
        const itemID = item.name.replace(/\s+/g, '_').toLowerCase();
        const isFree = item.type.toLowerCase() === 'free';
        
        const card = document.createElement('div');
        card.className = 'card template-card';
        card.onclick = () => openDetail(item);
        
        card.innerHTML = `
          <img src="${item.imageurl || 'logo1.png'}" class="template-img-thumb">
          <span class="badge" style="background:${isFree ? '#00d2ff':'#ffca28'}; color:#000">${item.type}</span>
          <h3 style="font-size: 1.1rem;">${item.name}</h3>
          <div class="price-tag" style="margin:5px 0;">${item.price}</div>
          
          <div class="card-actions" style="margin-top:auto">
            <span style="font-size: 11px; opacity: 0.6;">
              <i class="fas fa-heart"></i> <span id="like_${itemID}">0</span>
              <i class="fas fa-eye" style="margin-left:10px;"></i> <span id="view_${itemID}">0</span>
            </span>
            <span style="font-size:11px; color:#00d2ff">View Details</span>
          </div>
        `;
        container.appendChild(card);
        syncStats(itemID);
      });
    }

    function openDetail(item) {
      const itemID = item.name.replace(/\s+/g, '_').toLowerCase();
      const isFree = item.type.toLowerCase() === 'free';
      
      document.getElementById('detailTitle').innerText = item.name;
      document.getElementById('detailImg').src = item.imageurl || 'logo1.png';
      document.getElementById('detailDesc').innerText = item.description;
      
      const statusPill = document.getElementById('detailStatus');
      statusPill.innerText = item.type;
      statusPill.className = `status-pill ${isFree ? 'pill-free' : 'pill-paid'}`;

      const actionArea = document.getElementById('detailActionArea');
      const msg = `Hello Christian! I want to buy:\nID: HX-${itemID}\nName: ${item.name}\nPrice: ${item.price}`;
      const tgLink = `https://t.me/dechrisathx?text=${encodeURIComponent(msg)}`;

      actionArea.innerHTML = `
        <button class="btn" style="width:100%; max-width:400px; font-size:18px;" onclick="handleFinalAction('${item.type}', '${isFree ? item.downloadurl : tgLink}', '${itemID}')">
          ${isFree ? '<i class="fas fa-download"></i> Download Free' : '<i class="fab fa-telegram"></i> Purchase for ' + item.price}
        </button>
      `;

      document.getElementById('detailOverlay').style.display = 'block';
      document.body.style.overflow = 'hidden'; // Stop background scroll
      
      // Update View count on open
      fetch(`https://api.countapi.xyz/hit/hx_views/${itemID}`);
    }

    function closeDetail() {
      document.getElementById('detailOverlay').style.display = 'none';
      document.body.style.overflow = 'auto';
    }

    function handleFinalAction(type, url, id) {
      if (type.toLowerCase() === 'free') {
        window.open(url, '_blank');
      } else {
        currentRedirectUrl = url;
        document.getElementById('buyModal').style.display = 'block';
      }
    }

    function syncStats(id) {
      fetch(`https://api.countapi.xyz/get/hx_likes/${id}`).then(r => r.json()).then(d => {
        const el = document.getElementById(`like_${id}`);
        if(el) el.innerText = d.value || 0;
      });
      fetch(`https://api.countapi.xyz/get/hx_views/${id}`).then(r => r.json()).then(d => {
        const el = document.getElementById(`view_${id}`);
        if(el) el.innerText = d.value || 0;
      });
    }

    function closeModal() { document.getElementById('buyModal').style.display = 'none'; }
    document.getElementById('confirmBuy').onclick = () => { window.open(currentRedirectUrl, '_blank'); closeModal(); };

    fetchTemplates();
  </script>
</body>
</html>
