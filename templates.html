<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HX Store | Community Assets</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <link rel="stylesheet" href="style.css">
  <style>
    /* Likes & Social UI */
    .card-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
      padding-top: 10px;
      border-top: 1px solid rgba(0,210,255,0.1);
    }
    .like-btn {
      background: none;
      box-shadow: none;
      color: #ff4757;
      border: 1px solid #ff4757;
      padding: 5px 12px;
      font-size: 12px;
    }
    .like-btn:hover { background: rgba(255, 71, 87, 0.1); }
    .dark .like-btn { color: #ff6b81; border-color: #ff6b81; }

    /* Comment Section Wrapper */
    .comment-toggle {
      background: none;
      border: none;
      color: var(--primary);
      font-size: 12px;
      cursor: pointer;
      text-decoration: underline;
      padding: 0;
    }
    .comment-box {
      display: none;
      margin-top: 15px;
      padding: 10px;
      background: rgba(0,0,0,0.05);
      border-radius: 8px;
    }
    .dark .comment-box { background: rgba(255,255,255,0.05); }

    /* Fix for the Modal */
    .modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); }
  </style>
</head>
<body class="dark">

  <div id="buyModal" class="modal">
    <div class="modal-content" style="margin: 15% auto; padding: 30px; border-radius: 15px; max-width: 400px; text-align: center; background: #1e293b; color: #eee;">
      <i class="fas fa-shield-alt" style="font-size: 3rem; color: #00d2ff;"></i>
      <h3>Admin Verification</h3>
      <p>You will be redirected to <b>@dechrisathx</b> on Telegram to complete your purchase safely.</p>
      <button id="confirmBuy" class="btn" style="width:100%">Continue to Telegram</button>
      <p onclick="closeModal()" style="margin-top:15px; cursor:pointer; font-size:12px; opacity:0.6;">Cancel</p>
    </div>
  </div>

  <header>
    <a href="index.html"><img src="logo1.png" alt="HX" class="logo" /></a>
    <button onclick="document.body.classList.toggle('dark')"><i class="fas fa-adjust"></i></button>
  </header>

  <main>
    <section style="text-align: center; margin-bottom: 20px;">
      <h1>Digital Marketplace</h1>
      <p>Verified codes & premium community assets.</p>
    </section>

    <div id="loading"><i class="fas fa-spinner fa-spin"></i> Loading HX Community...</div>
    <div id="template-container" class="store-grid"></div>
  </main>

  <script>
    const api_url = "https://script.google.com/macros/s/AKfycbzpxWVXd9pUQe5cJCTJyxtNB6TVto1TEDPmwRYq3bo0eKjfKfPWm558HeMh3EaOCMfl/exec";
    let allTemplates = [];

    async function fetchTemplates() {
      try {
        const response = await fetch(api_url);
        const data = await response.json();
        allTemplates = data;
        renderTemplates(data);
        document.getElementById('loading').style.display = 'none';
      } catch (e) { console.error(e); }
    }

    function renderTemplates(items) {
      const container = document.getElementById('template-container');
      container.innerHTML = '';

      items.forEach((item, index) => {
        const itemID = item.name.replace(/\s+/g, '_').toLowerCase();
        const isFree = item.type.toLowerCase() === 'free';
        
        const card = document.createElement('div');
        card.className = 'card template-card';
        card.innerHTML = `
          <img src="${item.imageurl || 'logo1.png'}" class="template-img">
          <span class="badge">${item.category}</span>
          <h3>${item.name}</h3>
          <p style="font-size: 0.85rem; flex-grow: 1;">${item.description}</p>
          <div class="price-tag">${item.price}</div>
          
          <button class="btn" onclick="handleAction('${item.name}', '${item.price}', '${item.type}', '${item.downloadurl}', '${itemID}')">
            ${isFree ? 'Get Code' : 'Buy via Telegram'}
          </button>

          <div class="card-actions">
            <div>
              <button class="like-btn" id="btn_like_${itemID}" onclick="addLike('${itemID}')">
                <i class="fas fa-heart"></i> <span id="like_count_${itemID}">0</span>
              </button>
              <span style="font-size: 11px; opacity: 0.6; margin-left: 10px;">
                <i class="fas fa-download"></i> <span id="view_count_${itemID}">0</span>
              </span>
            </div>
            <p class="comment-toggle" onclick="toggleComments('${itemID}')">Comments</p>
          </div>

          <div id="comment_${itemID}" class="comment-box">
             <div id="cusdis_thread" 
                data-host="https://cusdis.com"
                data-app-id="PASTE_YOUR_CUSDIS_APP_ID_HERE"
                data-page-id="${itemID}"
                data-page-url="${window.location.href}"
                data-page-title="${item.name}">
             </div>
          </div>
        `;
        container.appendChild(card);
        syncStats(itemID);
      });
      // Initialize Cusdis SDK
      const script = document.createElement('script');
      script.src = "https://cusdis.com/js/cusdis.es.js";
      script.async = true;
      script.defer = true;
      document.body.appendChild(script);
    }

    // Like & Stats Functionality
    function syncStats(id) {
      fetch(`https://api.countapi.xyz/get/hx_likes/${id}`).then(r => r.json()).then(d => document.getElementById(`like_count_${id}`).innerText = d.value || 0);
      fetch(`https://api.countapi.xyz/get/hx_views/${id}`).then(r => r.json()).then(d => document.getElementById(`view_count_${id}`).innerText = d.value || 0);
    }

    function addLike(id) {
      fetch(`https://api.countapi.xyz/hit/hx_likes/${id}`)
        .then(r => r.json())
        .then(d => {
          document.getElementById(`like_count_${id}`).innerText = d.value;
          document.getElementById(`btn_like_${id}`).style.background = "#ff4757";
          document.getElementById(`btn_like_${id}`).style.color = "white";
        });
    }

    function toggleComments(id) {
      const box = document.getElementById(`comment_${id}`);
      box.style.display = box.style.display === 'block' ? 'none' : 'block';
    }

    function handleAction(name, price, type, url, id) {
      fetch(`https://api.countapi.xyz/hit/hx_views/${id}`);
      if (type.toLowerCase() === 'free') {
        window.open(url, '_blank');
      } else {
        const msg = `Hello Christian! I want to buy:\nID: HX-${id}\nItem: ${name}\nPrice: ${price}`;
        currentRedirectUrl = `https://t.me/dechrisathx?text=${encodeURIComponent(msg)}`;
        document.getElementById('buyModal').style.display = 'block';
      }
    }

    function closeModal() { document.getElementById('buyModal').style.display = 'none'; }
    document.getElementById('confirmBuy').onclick = () => { window.open(currentRedirectUrl, '_blank'); closeModal(); };

    fetchTemplates();
  </script>
</body>
  </html>
